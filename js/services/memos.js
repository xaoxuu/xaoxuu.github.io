utils.jq(()=>{$(function(){for(var e=document.getElementsByClassName("stellar-memos-api"),t=0;t<e.length;t++){const g=e[t];var i=g.getAttribute("api");if(null!=i){const c=g.getAttribute("avatar")||def.avatar,o=g.getAttribute("limit"),u=i.replace(/https:\/\/(.*?)\/(.*)/i,"$1");utils.request(g,i,function(e){var l=[],t=g.getAttribute("user"),d=(t&&0<t.length&&(l=t.split(",")),[]),t=g.getAttribute("hide");t&&0<t.length&&(d=t.split(",")),e.forEach((e,t)=>{if(!(o&&t>=o)&&(!(e.user&&e.user.login&&0<l.length)||l.includes(e.user.login))){var i,a=new Date(1e3*e.createdTs),s='<div class="timenode" index="'+t+'">',n=(s+='<div class="header">',l.length||d.includes("user")||(s+='<div class="user-info">',0<c.length&&(s+=`<img src="${c}">`),s=s+("<span>"+e.creatorName)+"</span></div>"),s=(s=(s+="<span>"+a.toLocaleString()+"</span>")+"</div>"+'<div class="body">')+marked.parse(e.content||""),[]);for(i of e.resourceList)i.type?.includes("image/")&&n.push(i);if(0<n.length){s+='<div class="tag-plugin image">';for(var r of n)0<r.externalLink?.length?s+=`<div class="image-bg"><img src="${r.externalLink}" data-fancybox="memos"></div>`:s+=`<div class="image-bg"><img src="https://${u}/o/r/${r.id}" data-fancybox="memos"></div>`;s+="</div>"}s=s+"</div>"+"</div>",$(g).append(s)}})})}}})});