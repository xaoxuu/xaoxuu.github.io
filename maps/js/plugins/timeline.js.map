{"version":3,"sources":["js/plugins/timeline.js"],"names":["StellarTimeline","reactions","laugh","hooray","confused","heart","rocket","eyes","requestAPI","url","callback","timeout","retryTimes","request","Promise","resolve","reject","status","timer","setTimeout","fetch","then","response","clearTimeout","ok","json","Error","data","error","layoutDiv","cfg","el","$","append","api","find","remove","query","URL","search","arr","content","users","filter","getAttribute","length","split","hide","hideStr","forEach","item","i","user","login","includes","cell","html_url","avatar_url","date","Date","created_at","toString","replace","title","name","tag_name","marked","parse","body","labels","label","encodeURI","color","zipball_url","total_count","_i","_Object$keys","Object","keys","key","comments","addClass","els","document","getElementsByClassName","obj"],"mappings":"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","file":"../../../js/plugins/timeline.js","sourcesContent":["const StellarTimeline = {\n  reactions: {\n    '+1': '👍',\n    '-1': '👎', \n    'laugh': '😀', \n    'hooray': '🎉', \n    'confused': '😕', \n    'heart': '❤️', \n    'rocket': '🚀', \n    'eyes': '👀'\n  },\n  requestAPI: (url, callback, timeout) => {\n    let retryTimes = 5;\n    function request() {\n      return new Promise((resolve, reject) => {\n        let status = 0; // 0 等待 1 完成 2 超时\n        let timer = setTimeout(() => {\n          if (status === 0) {\n            status = 2;\n            timer = null;\n            reject('请求超时');\n            if (retryTimes == 0) {\n              timeout();\n            }\n          }\n        }, 5000);\n        fetch(url).then(function(response) {\n          if (status !== 2) {\n            clearTimeout(timer);\n            resolve(response);\n            timer = null;\n            status = 1;\n          }\n          if (response.ok) {\n            return response.json();\n          }\n          throw new Error('Network response was not ok.');\n        }).then(function(data) {\n          retryTimes = 0;\n          callback(data);\n        }).catch(function(error) {\n          if (retryTimes > 0) {\n            retryTimes -= 1;\n            setTimeout(() => {\n              request();\n            }, 5000);\n          } else {\n            timeout();\n          }\n        });\n      });\n    }\n    request();\n  },\n  layoutDiv: (cfg) => {\n    const el = $(cfg.el)[0];\n    $(el).append('<div class=\"loading-wrap\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"2rem\" height=\"2rem\" preserveAspectRatio=\"xMidYMid meet\" viewBox=\"0 0 24 24\"><g fill=\"none\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-width=\"2\"><path stroke-dasharray=\"60\" stroke-dashoffset=\"60\" stroke-opacity=\".3\" d=\"M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z\"><animate fill=\"freeze\" attributeName=\"stroke-dashoffset\" dur=\"1.3s\" values=\"60;0\"/></path><path stroke-dasharray=\"15\" stroke-dashoffset=\"15\" d=\"M12 3C16.9706 3 21 7.02944 21 12\"><animate fill=\"freeze\" attributeName=\"stroke-dashoffset\" dur=\"0.3s\" values=\"15;0\"/><animateTransform attributeName=\"transform\" dur=\"1.5s\" repeatCount=\"indefinite\" type=\"rotate\" values=\"0 12 12;360 12 12\"/></path></g></svg></div>');\n    StellarTimeline.requestAPI(cfg.api, function(data) {\n      $(el).find('.loading-wrap').remove();\n      const query = new URL(cfg.api).search;\n      const arr = data.content || data;\n      var users = [];\n      const filter = el.getAttribute('user');\n      if (filter && filter.length > 0) {\n        users = filter.split(\",\");\n      }\n      var hide = [];\n      const hideStr = el.getAttribute('hide');\n      if (hideStr && hideStr.length > 0) {\n        hide = hideStr.split(\",\");\n      }\n      arr.forEach((item, i) => {\n        if (item.user && item.user.login && users.length > 0) {\n          if (!users.includes(item.user.login)) {\n            return;\n          }\n        }\n        var cell = '<div class=\"timenode\" index=\"' + i + '\">';\n        cell += '<div class=\"header\">';\n        if (!users.length && item.user && !hide.includes('user')) {\n          cell += '<a class=\"user-info\" href=\"' + item.user.html_url + '\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">';\n          cell += '<img src=\"' + item.user.avatar_url + '\">';\n          cell += '<span>' + item.user.login + '</span>';\n          cell += '</a>';\n        }\n        let date = new Date(item.created_at);\n        cell += '<p>' + date.toString().replace(/\\sGMT([^.]*)/i, \"\") + '</p>';\n        cell += '</div>';\n        cell += '<div class=\"body\">';\n        if (!hide.includes('title')) {\n          cell += '<p class=\"title\">';\n          cell += '<a href=\"' + item.html_url + '\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">';\n          cell += item.title || item.name || item.tag_name;\n          cell += '</a>';\n          cell += '</p>';\n        }\n        \n        cell += marked.parse(item.body || '');\n        if (!hide.includes('footer')) {\n          cell += '<div class=\"footer\">';\n          cell += '<div class=\"flex left\">';\n          if (item.labels) {\n            item.labels.forEach((label, i) => {\n              if (!query || !query.includes(encodeURI(label.name))) {\n                cell += '<div class=\"item label ' + label.name + '\" style=\"background:#' + label.color + '18;border-color:#' + label.color + '36\">';\n                cell += '<span>' + label.name + '</span>';\n                cell += '</div>';\n              }\n            });\n          } else if (item.zipball_url) {\n            cell += '<a class=\"item download\" href=\"' + item.zipball_url + '\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">';\n            cell += '<span>📦 ' + item.tag_name + '.zip</span>';\n            cell += '</a>';\n          }\n          cell += '</div>';\n          cell += '<div class=\"flex right\">';\n          if (item.reactions && item.reactions.total_count > 0) {\n            for (let key of Object.keys(StellarTimeline.reactions)) {\n              let num = item.reactions[key];\n              if (num > 0) {\n                cell += '<div class=\"item reaction ' + key + '\">';\n                cell += '<span>' + StellarTimeline.reactions[key] + ' ' + item.reactions[key] + '</span>';\n                cell += '</div>';\n              }\n            }\n          }\n          if (item.comments != null) {\n            cell += '<a class=\"item comments last\" href=\"' + item.html_url + '#issuecomment-new\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">';\n            cell += '<span><svg t=\"1666270368054\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"2528\" width=\"200\" height=\"200\"><path d=\"M952 64H72C32.3 64 0 96.3 0 136v508c0 39.7 32.3 72 72 72h261l128 128c14 14 32.5 21.1 50.9 21.1s36.9-7 50.9-21.1l128-128h261c39.7 0 72-32.3 72-72V136c0.2-39.7-32.1-72-71.8-72zM222 462c-39.8 0-72-32.2-72-72s32.2-72 72-72 72 32.2 72 72-32.2 72-72 72z m290-7.7c-39.8 0-72-32.2-72-72s32.2-72 72-72 72 32.2 72 72c0 39.7-32.2 72-72 72z m290 8c-39.8 0-72-32.2-72-72s32.2-72 72-72 72 32.2 72 72c0 39.7-32.2 72-72 72z\" p-id=\"2529\"></path></svg> ' + (item.comments || 0) + '</span>';\n            cell += '</a>';\n          }\n          \n          cell += '</div>';\n          cell += '</div>';\n        }\n        \n        cell += '</div>';\n        cell += '</div>';\n        $(el).append(cell);\n      });\n    }, function() {\n      $(el).find('.loading-wrap svg').remove();\n      $(el).find('.loading-wrap').append('<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"2rem\" height=\"2rem\" preserveAspectRatio=\"xMidYMid meet\" viewBox=\"0 0 24 24\"><g fill=\"none\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\"><path stroke-dasharray=\"60\" stroke-dashoffset=\"60\" d=\"M12 3L21 20H3L12 3Z\"><animate fill=\"freeze\" attributeName=\"stroke-dashoffset\" dur=\"0.5s\" values=\"60;0\"/></path><path stroke-dasharray=\"6\" stroke-dashoffset=\"6\" d=\"M12 10V14\"><animate fill=\"freeze\" attributeName=\"stroke-dashoffset\" begin=\"0.6s\" dur=\"0.2s\" values=\"6;0\"/></path></g><circle cx=\"12\" cy=\"17\" r=\"1\" fill=\"currentColor\" fill-opacity=\"0\"><animate fill=\"freeze\" attributeName=\"fill-opacity\" begin=\"0.8s\" dur=\"0.4s\" values=\"0;1\"/></circle></svg>');\n      $(el).find('.loading-wrap').addClass('error');\n    });\n  },\n}\n\n$(function () {\n  const els = document.getElementsByClassName('stellar-timeline-api');\n  for (var i = 0; i < els.length; i++) {\n    const el = els[i];\n    const api = el.getAttribute('api');\n    if (api == null) {\n      continue;\n    }\n    var obj = new Object();\n    obj.el = el;\n    obj.api = api;\n    StellarTimeline.layoutDiv(obj);\n  }\n});\n"]}