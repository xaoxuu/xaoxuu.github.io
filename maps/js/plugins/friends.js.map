{"version":3,"sources":["js/plugins/friends.js"],"names":["friendsjs","requestAPI","url","callback","timeout","retryTimes","request","Promise","resolve","reject","status","timer","setTimeout","fetch","then","response","clearTimeout","ok","json","Error","data","error","layout","cfg","el","$","append","api","find","remove","content","forEach","item","i","user","html_url","avatar_url","avatar","title","login","addClass","els","document","getElementsByClassName","length","getAttribute","Object"],"mappings":"AAAA,aAAA,IAAMA,UAAY,CAChBC,WAAY,SAACC,EAAKC,EAAUC,GAC1B,IAAIC,EAAa,GACjB,SAASC,IACP,OAAO,IAAIC,SAAQ,SAACC,EAASC,GAC3B,IAAIC,EAAS,EACTC,EAAQC,YAAW,WACN,IAAXF,IACFA,EAAS,EACTC,EAAQ,KACRF,EAAO,QACW,GAAdJ,GACFD,IAGN,GAAG,KACHS,MAAMX,GAAKY,MAAK,SAASC,GAOvB,GANe,IAAXL,IACFM,aAAaL,GACbH,EAAQO,GACRJ,EAAQ,KACRD,EAAS,GAEPK,EAASE,GACX,OAAOF,EAASG,OAElB,MAAM,IAAIC,MAAM,+BAClB,IAAGL,MAAK,SAASM,GACff,EAAa,EACbF,EAASiB,EACX,IAAE,UAAO,SAASC,GACZhB,EAAa,GACfA,GAAc,EACdO,YAAW,WACTN,GACF,GAAG,MAEHF,GAEJ,GACF,GACF,CACAE,EACF,EACAgB,OAAQ,SAACC,GACP,IAAMC,EAAKC,EAAEF,EAAIC,IAAI,GACrBC,EAAED,GAAIE,OAAO,wzBACb1B,UAAUC,WAAWsB,EAAII,KAAK,SAASP,GACrCK,EAAED,GAAII,KAAK,iBAAiBC,UAChBT,EAAKU,SAAWV,GACxBW,SAAQ,SAACC,EAAMC,GACjB,IAAIC,EAAO,0BACXA,GAAQ,mFACRA,GAAQ,WAAaF,EAAKG,UAAYH,EAAK9B,KAAO,KAClDgC,GAAQ,cAAgBF,EAAKI,YAAcJ,EAAKK,QAAUd,EAAIc,QAAU,oCAAsCd,EAAIc,OAAS,QAC3HH,GAAQ,4BAA8BF,EAAKM,OAASN,EAAKO,OAAS,gBAClEL,GAAQ,OACRA,GAAQ,SACRT,EAAED,GAAII,KAAK,eAAeF,OAAOQ,EACnC,GACF,IAAG,WACDT,EAAED,GAAII,KAAK,qBAAqBC,SAChCJ,EAAED,GAAII,KAAK,iBAAiBF,OAAO,8tBACnCD,EAAED,GAAII,KAAK,iBAAiBY,SAAS,QACvC,GACF,GAGFf,GAAE,WAEA,IADA,IAAMgB,EAAMC,SAASC,uBAAuB,uBACnCV,EAAI,EAAGA,EAAIQ,EAAIG,OAAQX,IAAK,CACnC,IAAMT,EAAKiB,EAAIR,GACTN,EAAMH,EAAGqB,aAAa,OAC5B,GAAW,MAAPlB,EAAJ,CAGA,IAAIJ,EAAM,IAAIuB,OACdvB,EAAIC,GAAKA,EACTD,EAAII,IAAMA,EACVJ,EAAG,SAASC,EAAGqB,aAAa,SAC5BtB,EAAIc,OAAS,kFACbrC,UAAUsB,OAAOC,EANjB,CAOF,CACF","file":"../../../js/plugins/friends.js","sourcesContent":["const friendsjs = {\n  requestAPI: (url, callback, timeout) => {\n    let retryTimes = 5;\n    function request() {\n      return new Promise((resolve, reject) => {\n        let status = 0; // 0 等待 1 完成 2 超时\n        let timer = setTimeout(() => {\n          if (status === 0) {\n            status = 2;\n            timer = null;\n            reject('请求超时');\n            if (retryTimes == 0) {\n              timeout();\n            }\n          }\n        }, 5000);\n        fetch(url).then(function(response) {\n          if (status !== 2) {\n            clearTimeout(timer);\n            resolve(response);\n            timer = null;\n            status = 1;\n          }\n          if (response.ok) {\n            return response.json();\n          }\n          throw new Error('Network response was not ok.');\n        }).then(function(data) {\n          retryTimes = 0;\n          callback(data);\n        }).catch(function(error) {\n          if (retryTimes > 0) {\n            retryTimes -= 1;\n            setTimeout(() => {\n              request();\n            }, 5000);\n          } else {\n            timeout();\n          }\n        });\n      });\n    }\n    request();\n  },\n  layout: (cfg) => {\n    const el = $(cfg.el)[0];\n    $(el).append('<div class=\"loading-wrap\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"2rem\" height=\"2rem\" preserveAspectRatio=\"xMidYMid meet\" viewBox=\"0 0 24 24\"><g fill=\"none\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-width=\"2\"><path stroke-dasharray=\"60\" stroke-dashoffset=\"60\" stroke-opacity=\".3\" d=\"M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z\"><animate fill=\"freeze\" attributeName=\"stroke-dashoffset\" dur=\"1.3s\" values=\"60;0\"/></path><path stroke-dasharray=\"15\" stroke-dashoffset=\"15\" d=\"M12 3C16.9706 3 21 7.02944 21 12\"><animate fill=\"freeze\" attributeName=\"stroke-dashoffset\" dur=\"0.3s\" values=\"15;0\"/><animateTransform attributeName=\"transform\" dur=\"1.5s\" repeatCount=\"indefinite\" type=\"rotate\" values=\"0 12 12;360 12 12\"/></path></g></svg></div>');\n    friendsjs.requestAPI(cfg.api, function(data) {\n      $(el).find('.loading-wrap').remove();\n      const arr = data.content || data;\n      arr.forEach((item, i) => {\n        var user = '<div class=\"user-card\">';\n        user += '<a class=\"card-link\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\"';\n        user += ' href=\"' + (item.html_url || item.url) + '\">';\n        user += '<img src=\"' + (item.avatar_url || item.avatar || cfg.avatar) + '\" onerror=\"javascript:this.src=\\'' + cfg.avatar + '\\';\">';\n        user += '<div class=\"name\"><span>' + (item.title || item.login) + '</span></div>';\n        user += '</a>';\n        user += '</div>';\n        $(el).find('.group-body').append(user);\n      });\n    }, function() {\n      $(el).find('.loading-wrap svg').remove();\n      $(el).find('.loading-wrap').append('<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"2rem\" height=\"2rem\" preserveAspectRatio=\"xMidYMid meet\" viewBox=\"0 0 24 24\"><g fill=\"none\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\"><path stroke-dasharray=\"60\" stroke-dashoffset=\"60\" d=\"M12 3L21 20H3L12 3Z\"><animate fill=\"freeze\" attributeName=\"stroke-dashoffset\" dur=\"0.5s\" values=\"60;0\"/></path><path stroke-dasharray=\"6\" stroke-dashoffset=\"6\" d=\"M12 10V14\"><animate fill=\"freeze\" attributeName=\"stroke-dashoffset\" begin=\"0.6s\" dur=\"0.2s\" values=\"6;0\"/></path></g><circle cx=\"12\" cy=\"17\" r=\"1\" fill=\"currentColor\" fill-opacity=\"0\"><animate fill=\"freeze\" attributeName=\"fill-opacity\" begin=\"0.8s\" dur=\"0.4s\" values=\"0;1\"/></circle></svg>');\n      $(el).find('.loading-wrap').addClass('error');\n    });\n  },\n}\n\n$(function () {\n  const els = document.getElementsByClassName('stellar-friends-api');\n  for (var i = 0; i < els.length; i++) {\n    const el = els[i];\n    const api = el.getAttribute('api');\n    if (api == null) {\n      continue;\n    }\n    var cfg = new Object();\n    cfg.el = el;\n    cfg.api = api;\n    cfg.class = el.getAttribute('class');\n    cfg.avatar = 'https://fastly.jsdelivr.net/gh/cdn-x/placeholder@1.0.1/avatar/round/3442075.svg';\n    friendsjs.layout(cfg);\n  }\n});\n"]}