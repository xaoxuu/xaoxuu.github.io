{"version":3,"sources":["js/plugins/weibo.js"],"names":["weibojs","requestAPI","url","callback","timeout","retryTimes","request","Promise","resolve","reject","status","timer","setTimeout","fetch","then","response","clearTimeout","ok","json","Error","data","error","layoutDiv","cfg","el","$","append","api","find","remove","arr","tweets","limit","getAttribute","forEach","item","i","cell","user","avatar_hd","avatar","nick_name","created_at","content","reposts_count","comments_count","attitudes_count","addClass","els","document","getElementsByClassName","length","Object"],"mappings":"AAAA,aAAA,IAAMA,QAAU,CACdC,WAAY,SAACC,EAAKC,EAAUC,GAC1B,IAAIC,EAAa,GACjB,SAASC,IACP,OAAO,IAAIC,SAAQ,SAACC,EAASC,GAC3B,IAAIC,EAAS,EACTC,EAAQC,YAAW,WACN,IAAXF,IACFA,EAAS,EACTC,EAAQ,KACRF,EAAO,QACW,GAAdJ,GACFD,IAGN,GAAG,KACHS,MAAMX,GAAKY,MAAK,SAASC,GAOvB,GANe,IAAXL,IACFM,aAAaL,GACbH,EAAQO,GACRJ,EAAQ,KACRD,EAAS,GAEPK,EAASE,GACX,OAAOF,EAASG,OAElB,MAAM,IAAIC,MAAM,+BAClB,IAAGL,MAAK,SAASM,GACff,EAAa,EACbF,EAASiB,EACX,IAAE,UAAO,SAASC,GACZhB,EAAa,GACfA,GAAc,EACdO,YAAW,WACTN,GACF,GAAG,MAEHF,GAEJ,GACF,GACF,CACAE,EACF,EACAgB,UAAW,SAACC,GACV,IAAMC,EAAKC,EAAEF,EAAIC,IAAI,GACrBC,EAAED,GAAIE,OAAO,wzBACb1B,QAAQC,WAAWsB,EAAII,KAAK,SAASP,GACnCK,EAAED,GAAII,KAAK,iBAAiBC,SAC5B,IAAMC,EAAMV,EAAKW,QAAU,GACrBC,EAAQR,EAAGS,aAAa,SAC9BH,EAAII,SAAQ,SAACC,EAAMC,GACjB,KAAIJ,GAASI,GAAKJ,GAAlB,CAGA,IAAIK,EAAO,gCAAkCD,EAAI,KACjDC,GAAQ,uBACRA,GAAQ,0BACRA,GAAQ,cAAgBjB,EAAKkB,KAAKC,WAAahB,EAAIiB,QAAU,oCAAsCjB,EAAIiB,OAAS,QAChHH,GAAQ,SAAWjB,EAAKkB,KAAKG,UAAY,UACzCJ,GAAQ,SACRA,GAAQ,MAAQF,EAAKO,WAAa,OAClCL,GAAQ,SACRA,GAAQ,qBACRA,GAAQ,yBAA2BF,EAAKjC,IAAM,iEAC9CmC,GAAQF,EAAKQ,QACbN,GAAQ,OAGRA,GAAQ,uBACRA,GAAQ,0BACRA,GAAQ,SACRA,GAAQ,2BACRA,GAAQ,qCACRA,GAAQ,uCAAyCF,EAAKjC,IAAM,kFAC5DmC,GAAQ,YAAwBF,EAAKS,cAAgB,UACrDP,GAAQ,OACRA,GAAQ,SACRA,GAAQ,uCAAyCF,EAAKjC,IAAM,kFAC5DmC,GAAQ,wlBACJF,EAAKU,gBAAkB,GAAK,UAChCR,GAAQ,OACRA,GAAQ,wCACRA,GAAQ,uCAAyCF,EAAKjC,IAAM,kFAC5DmC,GAAQ,YAAwBF,EAAKW,gBAAkB,UACvDT,GAAQ,OACRA,GAAQ,SAERA,GAAQ,SACRA,GAAQ,SAERZ,EAAED,GAAIE,OAAOW,EArCb,CAsCF,GACF,IAAG,WACDZ,EAAED,GAAII,KAAK,qBAAqBC,SAChCJ,EAAED,GAAII,KAAK,iBAAiBF,OAAO,8tBACnCD,EAAED,GAAII,KAAK,iBAAiBmB,SAAS,QACvC,GACF,GAGFtB,GAAE,WAEA,IADA,IAAMuB,EAAMC,SAASC,uBAAuB,qBACnCd,EAAI,EAAGA,EAAIY,EAAIG,OAAQf,IAAK,CACnC,IAAMZ,EAAKwB,EAAIZ,GACTT,EAAMH,EAAGS,aAAa,OAC5B,GAAW,MAAPN,EAAJ,CAGA,IAAIJ,EAAM,IAAI6B,OACd7B,EAAIC,GAAKA,EACTD,EAAII,IAAMA,EACVJ,EAAIiB,OAAS,kFACbxC,QAAQsB,UAAUC,EALlB,CAMF,CACF","file":"../../../js/plugins/weibo.js","sourcesContent":["const weibojs = {\n  requestAPI: (url, callback, timeout) => {\n    let retryTimes = 5;\n    function request() {\n      return new Promise((resolve, reject) => {\n        let status = 0; // 0 Á≠âÂæÖ 1 ÂÆåÊàê 2 Ë∂ÖÊó∂\n        let timer = setTimeout(() => {\n          if (status === 0) {\n            status = 2;\n            timer = null;\n            reject('ËØ∑Ê±ÇË∂ÖÊó∂');\n            if (retryTimes == 0) {\n              timeout();\n            }\n          }\n        }, 5000);\n        fetch(url).then(function(response) {\n          if (status !== 2) {\n            clearTimeout(timer);\n            resolve(response);\n            timer = null;\n            status = 1;\n          }\n          if (response.ok) {\n            return response.json();\n          }\n          throw new Error('Network response was not ok.');\n        }).then(function(data) {\n          retryTimes = 0;\n          callback(data);\n        }).catch(function(error) {\n          if (retryTimes > 0) {\n            retryTimes -= 1;\n            setTimeout(() => {\n              request();\n            }, 5000);\n          } else {\n            timeout();\n          }\n        });\n      });\n    }\n    request();\n  },\n  layoutDiv: (cfg) => {\n    const el = $(cfg.el)[0];\n    $(el).append('<div class=\"loading-wrap\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"2rem\" height=\"2rem\" preserveAspectRatio=\"xMidYMid meet\" viewBox=\"0 0 24 24\"><g fill=\"none\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-width=\"2\"><path stroke-dasharray=\"60\" stroke-dashoffset=\"60\" stroke-opacity=\".3\" d=\"M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z\"><animate fill=\"freeze\" attributeName=\"stroke-dashoffset\" dur=\"1.3s\" values=\"60;0\"/></path><path stroke-dasharray=\"15\" stroke-dashoffset=\"15\" d=\"M12 3C16.9706 3 21 7.02944 21 12\"><animate fill=\"freeze\" attributeName=\"stroke-dashoffset\" dur=\"0.3s\" values=\"15;0\"/><animateTransform attributeName=\"transform\" dur=\"1.5s\" repeatCount=\"indefinite\" type=\"rotate\" values=\"0 12 12;360 12 12\"/></path></g></svg></div>');\n    weibojs.requestAPI(cfg.api, function(data) {\n      $(el).find('.loading-wrap').remove();\n      const arr = data.tweets || [];\n      const limit = el.getAttribute('limit');\n      arr.forEach((item, i) => {\n        if (limit && i >= limit) {\n          return;\n        }\n        var cell = '<div class=\"timenode\" index=\"' + i + '\">';\n        cell += '<div class=\"header\">';\n        cell += '<div class=\"user-info\">';\n        cell += '<img src=\"' + (data.user.avatar_hd || cfg.avatar) + '\" onerror=\"javascript:this.src=\\'' + cfg.avatar + '\\';\">';\n        cell += '<span>' + data.user.nick_name + '</span>';\n        cell += '</div>';\n        cell += '<p>' + item.created_at + '</p>';\n        cell += '</div>';\n        cell += '<div class=\"body\">';\n        cell += '<a class=\"body\" href=\"' + item.url + '\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">';\n        cell += item.content;\n        cell += '</a>';\n        // cell += '</div>';\n        // ÊØèÊù°ÂæÆÂçöÁöÑÂè≥‰∏ãËßí ËΩ¨Âèë ËØÑËÆ∫ ÁÇπËµû\n        cell += '<div class=\"footer\">';\n        cell += '<div class=\"flex left\">';\n        cell += '</div>';\n        cell += '<div class=\"flex right\">';\n        cell += '<div class=\"item reaction repost\">';\n        cell += '<a class=\"item comments last\" href=\"' + item.url + '#issuecomment-new\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">';\n        cell += '<span>' + 'üîó' + ' ' + item.reposts_count + '</span>';\n        cell += '</a>';\n        cell += '</div>';\n        cell += '<a class=\"item comments last\" href=\"' + item.url + '#issuecomment-new\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">';\n        cell += '<span><svg t=\"1666270368054\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"2528\" width=\"200\" height=\"200\"><path d=\"M952 64H72C32.3 64 0 96.3 0 136v508c0 39.7 32.3 72 72 72h261l128 128c14 14 32.5 21.1 50.9 21.1s36.9-7 50.9-21.1l128-128h261c39.7 0 72-32.3 72-72V136c0.2-39.7-32.1-72-71.8-72zM222 462c-39.8 0-72-32.2-72-72s32.2-72 72-72 72 32.2 72 72-32.2 72-72 72z m290-7.7c-39.8 0-72-32.2-72-72s32.2-72 72-72 72 32.2 72 72c0 39.7-32.2 72-72 72z m290 8c-39.8 0-72-32.2-72-72s32.2-72 72-72 72 32.2 72 72c0 39.7-32.2 72-72 72z\" p-id=\"2529\"></path></svg> '\n         + (item.comments_count || 0) + '</span>';\n        cell += '</a>';\n        cell += '<div class=\"item reaction attitudes\">';\n        cell += '<a class=\"item comments last\" href=\"' + item.url + '#issuecomment-new\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">';\n        cell += '<span>' + 'üëç' + ' ' + item.attitudes_count + '</span>';\n        cell += '</a>';\n        cell += '</div>';\n\n        cell += '</div>';\n        cell += '</div>';\n        // Âè≥‰∏ãËßíÁªìÊùü\n        $(el).append(cell);\n      });\n    }, function() {\n      $(el).find('.loading-wrap svg').remove();\n      $(el).find('.loading-wrap').append('<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"2rem\" height=\"2rem\" preserveAspectRatio=\"xMidYMid meet\" viewBox=\"0 0 24 24\"><g fill=\"none\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\"><path stroke-dasharray=\"60\" stroke-dashoffset=\"60\" d=\"M12 3L21 20H3L12 3Z\"><animate fill=\"freeze\" attributeName=\"stroke-dashoffset\" dur=\"0.5s\" values=\"60;0\"/></path><path stroke-dasharray=\"6\" stroke-dashoffset=\"6\" d=\"M12 10V14\"><animate fill=\"freeze\" attributeName=\"stroke-dashoffset\" begin=\"0.6s\" dur=\"0.2s\" values=\"6;0\"/></path></g><circle cx=\"12\" cy=\"17\" r=\"1\" fill=\"currentColor\" fill-opacity=\"0\"><animate fill=\"freeze\" attributeName=\"fill-opacity\" begin=\"0.8s\" dur=\"0.4s\" values=\"0;1\"/></circle></svg>');\n      $(el).find('.loading-wrap').addClass('error');\n    });\n  },\n}\n\n$(function () {\n  const els = document.getElementsByClassName('stellar-weibo-api');\n  for (var i = 0; i < els.length; i++) {\n    const el = els[i];\n    const api = el.getAttribute('api');       // Ëøô‰∏™APIÂèØ‰ª•ËøîÂõûÂæÆÂçöÁöÑjsonÊñá‰ª∂\n    if (api == null) {\n      continue;\n    }\n    var cfg = new Object();\n    cfg.el = el;\n    cfg.api = api;\n    cfg.avatar = 'https://fastly.jsdelivr.net/gh/cdn-x/placeholder@1.0.1/avatar/round/3442075.svg';\n    weibojs.layoutDiv(cfg);\n  }\n});\n"]}